---
title: "VAST Challenge 2021: Mini-Challenge 2"
description: |
  A short description of the post.
author:
  - name: Syed Ahmad Zaki
    url: https://www.google.com/
date: 06-08-2021
output:
  distill::distill_article:
    self_contained: false
    code_folding: true
    toc: true
    toc_depth: 3
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)

# Installing and loading necessary packages
if (!require("pacman")) install.packages("pacman")
pacman::p_load(ggplot2, tidyverse, readr, jpeg, grid, plotly, gganimate, writexl, qwraps2)

```

**Team Member:**  
Syed Ahmad Zaki, Singapore Management University of Singapore, ahmadzaki.2020@mitb.smu.edu.sg   
Student Team:  YES  

**Tools Used:**  
Rmarkdown  

**Approximately how many hours were spent working on this submission in total?**  
Provide an estimate of the total number of hours worked on this submission by your entire team.  

**May we post your submission in the Visual Analytics Benchmark Repository after VAST Challenge 2021 is complete?** YES  

**Video**
Provide a link to your video.  Example:
http://www.westbirmingham.ac.uk/uwb-smith-mc2-video.wmv

---

As a visual analytics expert assisting law enforcement, your mission is to identify which GASTech employees made which purchases and identify suspicious patterns of behavior.. You must cope with uncertainties that result from missing, conflicting, and imperfect data to make recommendations for further investigation.

Use visual analytics to analyze the available data and develop responses to the questions below. In addition, prepare a video that shows how you used visual analytics to solve this challenge. Submission instructions are available here. Entry forms are available for download below.
https://vast-challenge.github.io/2021/MC2.html

---

## 1.	Data Preparation


Loading all datasets
```{r}

# Loading all datasets and image
mc2 <- jpeg::readJPEG("img/MC2-tourist.jpg", native = TRUE) # Add jpeg map file
gps <- readr::read_csv("data/gps.csv") # Add gps data
assignments <- readr::read_csv("data/car-assignments.csv") # Add car assignments

```

GPS Data Manipulation
```{r}

# GPS Data Manipulation
gps_name <- left_join(gps,assignments, by = c("id" = "CarID")) # Merge car assignments to gps data
gps_name$Timestamp <- as.POSIXct(gps_name$Timestamp, format = "%m/%d/%Y  %H:%M:%S", tz = "GMT") # Switching month-day format
gps_name <- gps_name[with(gps_name,order(id,Timestamp)),] # Sort first by ID in ascending order and then Timestamp by oldest to newest
gps_name <- gps_name %>% # Add running number in the first column
  mutate(No = 1:n()) %>% 
  select(No, everything()) 

gps_name <- gps_name %>% # Create additional column indicating time taken from previous timestamp for same ID
#    group_by(id) %>%
    mutate(Delta = Timestamp - lag(Timestamp, default = first(Timestamp)))

gps_name$Delta <- as.numeric(gps_name$Delta)

spots <- gps_name %>% # Filtering out gps coordinates where stationary for only 0-9 secs
  filter(!(Delta %in% c(0:9)))
spots$No <- rep(1:3648, times = 1)

spots_l <- spots[,4:5] # Extract only lat long
spots_ll <- spots_l %>% slice(rep(1:n(), each = 3648))
spots_ll$No <- rep(1:3648, times = 3648)
spots_l$Noo <- rep(1:3648, times = 1)
spots_ll <- left_join(spots_ll,spots_l, by = c("No" = "Noo"))
spots_ll$Diff <- sqrt((spots_ll$lat.x-spots_ll$lat.y)^2+(spots_ll$long.x-spots_ll$long.y)^2)

#n_perc(spots_ll$Diff < 0.05)

#write_csv(spots,"C:\\Users\\syeda\\OneDrive\\Desktop\\spots.csv")

# Mapping map and gps together specifically for CarID #1
mapping_spots <- ggplot(spots, aes(long, lat)) +
  annotation_custom(rasterGrob(mc2,
    width = unit(1, "npc"),
    height = unit(1,"npc")),
  xmin = 24.8244, xmax = 24.9096, ymin = 36.0453, ymax = 36.0952) + 
  geom_point(size = 0.1) + 
  coord_fixed(xlim = c(24.8244, 24.9096), ylim = c(36.0453, 36.0952)) + # Fixing the scales regardless of filtering of points
  theme_bw() + theme(panel.border = element_blank(), # Remove background and grids and reformat scales and axis
                     panel.grid.major = element_blank(), 
                     panel.grid.minor = element_blank(), 
                     axis.line = element_line(colour = "black"))  

mapping_spots

```



## 2.	Data Exploration Analysis

---

**Questions**

1 –– Using just the credit and loyalty card data, identify the most popular locations, and when they are popular. What anomalies do you see? What corrections would you recommend to correct these anomalies? Please limit your answer to 8 images and 300 words.

Provide your answer and corresponding images here.

2 – Add the vehicle data to your analysis of the credit and loyalty card data. How does your assessment of the anomalies in question 1 change based on this new data? What discrepancies between vehicle, credit, and loyalty card data do you find? Please limit your answer to 8 images and 500 words.

Provide your answer and corresponding images here.

3 – Can you infer the owners of each credit card and loyalty card? What is your evidence? Where are there uncertainties in your method? Where are there uncertainties in the data? Please limit your answer to 8 images and 500 words.

Provide your answer and corresponding images here.

4 –– Given the data sources provided, identify potential informal or unofficial relationships among GASTech personnel. Provide evidence for these relationships. Please limit your response to 8 images and 500 words.

Provide your answer and corresponding images here.

5 –– Do you see evidence of suspicious activity? Identify 1- 10 locations where you believe the suspicious activity is occurring, and why    Please limit your response to 10 images and 500 words.

Provide your answer and corresponding images here.

6 –– If you solved this mini-challenge in 2014, how did you approach it differently this year?

Provide your answer here.

```{r}

2 + 2
Sys.timezone(location = TRUE)

```




Testing the use of a static image as background and showcasing the gps data on it using ggplot

```{r}



# Mapping map and gps together specifically for CarID #1
mapping <- ggplot(gps_name %>%
                    filter(id == "1"),
                  aes(long, lat)) +
  annotation_custom(rasterGrob(mc2,
    width = unit(1, "npc"),
    height = unit(1,"npc")),
  xmin = 24.8244, xmax = 24.9096, ymin = 36.0453, ymax = 36.0952) + 
  geom_point(size = 0.1) + 
  coord_fixed(xlim = c(24.8244, 24.9096), ylim = c(36.0453, 36.0952)) + # Fixing the scales regardless of filtering of points
  theme_bw() + theme(panel.border = element_blank(), # Remove background and grids and reformat scales and axis
                     panel.grid.major = element_blank(), 
                     panel.grid.minor = element_blank(), 
                     axis.line = element_line(colour = "black"))  
#  + transition_time(Timestamp) +
#  labs(title = "Date:{frame_time}")

mapping

```


